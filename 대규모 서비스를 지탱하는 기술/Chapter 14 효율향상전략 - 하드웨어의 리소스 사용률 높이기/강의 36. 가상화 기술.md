# Chapter 14 효율향상전략 - 하드웨어의 리소스 사용률 높이기> ### 가상화 기술, 자체제작 서버 - 규모의 크기와 리소스 사용률> 가상화 기술을 사용해서 호스트의 집적도를 상승시킴으로써 전체 리소스 사용률을 올려야 한다.   > 또한 자체제작 서버를 사용함으로써 서버 이중화 사양을 가볍게 하여 시스템 전체의 저비용화를 추진해야 한다.---## 강의 36. 가상화 기술### 가상화 기술의 도입#### 가상화 기술의 목적- 확장성  - 오버헤드의 최소화- 비용대비 성능  - 리소스 사용률 향상  - 운용의 유연함(환경의 단순함)- 고가용성  - 환경의 격리하테나에서도 시스템 전체적인 확장성을 높이거나, 비용대비 성능을 올리고, 리소스 사용률을 높이고, 유연하게 운용할 수 있게 하고, 서버 환경을 격리해서 고가용성을 실현하는 것을 목표로 한다.### 가상화 기술의 효용#### 하테나에서의 가상화 기술 효용 결과1. IPMI를 대체하는 하이퍼바이저2. 하드웨어 간 차이 흡수(=> 환경 추상화)3. 준 가상화(ParaVirtualization) 사용4. 리소스 소비 제어   - 과부하 경고   - 부하 조정(1)   벤더 서버에는 IPMI(Intelligent Platform Management Interface)라는 리모트 관리기능이 있는데, 이를 대체해서 하이퍼바이저를 사용할 수 있게 되어 있다.   하이퍼바이저는 이른바 호스트 OS를 말한다.   서버 상에 최초에 기동하는 OS를 하이퍼 바이저, 호스트 OS 상에서 기동하는 OS를 게스트 OS라고 한다.   IPMI의 대체품으로서 하이퍼바이저라는 계층을 하나 늘림으로써 게스트 OS를 리모트에서 제어하고 있다.(2)    하드웨어 차이를 흡수해서 환경을 추상화할 수 있다.   이에 따라 새로운 하드웨어나 오래된 하드웨어로도 차분에 신경 쓰지 말고 사용할 수 있다.(3)   Xen에 특화된 이야기지만, 가상화로 인한 오버헤드를 줄이기 위해 하드웨어를 완전히 에뮬레이팅 하지 않은 준 가상화라는 방식이 있다.(4)   리소스 소비를 소프트웨어 레벨에서 강력하게 제어할 수 있게 되어 있다.   리소스 소비를 제어함으로써 과부하 경고, 부하 조정을 수행한다.### 가상화 서버 구축정책가상화 기술을 도입하는 가장 기본적인 목적은 하드웨어의 이용효율 향상이다.   하드웨어의 이용효율 향상을 위해 남아있는 리소스를 사용하는 게스트 OS를 투입한다.가상화 기술을 도입할 때 중앙에 신뢰성이 높은 큰 규모의 스토리지를 두고 네트워크로 파일시스템을 마운트하는 구성을 채택하는 경우도 일반적으로 많지만, 이런 형태는 사용하지 않는다.   그 이유는 고가의 스토리지 서버를 사용하지 않으면 충분한 안전성을 확보할 수 없기 때문이다.#### 가상화 서버 - 웹 서버구체적인 게스트 OS 구성을 살펴보자.      예를 들면 4GB 메모리를 탑재하고 있는 서버에 웹 서버용 게스트 OS에 주로 3.5GB를 할당했다고 치면 최근 메모리 가격이 낮아지고 있으므로 기본적으로 8GB로 증가시키기로 한다.    그렇게 되면 메모리에 여유가 생기므로 웹 서버용 게스트 OS의 메모를 5.5GB로 확장하고, 또한 memcached 용 게스트 OS에 2GB를 할당한다.#### 가상화 서버 - DB 서버DB 서버에서는 DB가 메모리를 어느 정도 소비하지만, CPU 리소스와 I/O 리소스는 그다지 소비하지 않는 경우가 많다.   이런 경우에는 웹 서버용 게스트 OS를 탑재해서 I/O와 CPU를 모두 사용할 수 있도록 한다.### 가상화로 얻은 장점 정리구체적인 장점으로는 물리적인 리소스 제약에서 해방됨으로써 동적으로 변경할 수 있게 되고, 게스트 OS의 마이그레이션이나 복제가 용이해진다.   이에 따라 서버 증설이 용이해지고 확장성을 확보할 수 있다.소프트웨어 레벨에서 호스트 리소스를 강력하게 제어할 수 있고 비 정상 동작 시 문제를 국소화시키고 호스트를 쉽게 제어할 수 있게 된다.   효율이 향상되고 시스템을 전체적으로 안정화할 수 있게 된다.### 가상화와 운용 - 서버관리툴로 운용측면에서 가상화의 장점을 살리다![특정에 포함되어 있는 서버의 구성과 부하](image/server_architecture_with_load_.png)가상화된 환경에서는 게스트 OS를 특정 호스트에서 다른 호스트로 이동시키는 일이 자주 있다.   따라서 필요할 때마다 게스트 OS의 부모 호스트를 관리툴 등에서 찾아보는 일이 매우 번거로운 일이므로 "parent"라고 앞에 덧붙이기만 하면 부모 호스트를 표시하도록 하고 있다.### 가상화 도입 시 주의할 점> Q : 가상화의 단점은 어떤 게 있습니까?    > A : 전형적인 단점으로는 성능상의 오버헤드가 있다. - CPU에서 2~3%- 메모리 성능에서 1할 정도- 네트워크 성능은 절반 정도- I/O 성능이 5% 정도 떨어진다.가상화 기술 구현상 결함으로 인해 갑자기 네트워크가 단절되는 등의 불안정 요인이 약간 늘어나는 경우가 있는데, 이에 비해 장점이 충분히 크므로 가상화 기술을 사용하고 있다.    하지만 네트워크 성능이 반감해버린다는 것은 용도에 따라서는 꽤 심각하다.    