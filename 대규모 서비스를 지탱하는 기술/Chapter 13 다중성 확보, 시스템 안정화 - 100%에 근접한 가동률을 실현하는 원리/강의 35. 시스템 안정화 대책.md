# Chapter 13 다중성 확보, 시스템 안정화 - 100%에 근접한 가동률을 실현하는 원리---## 강의 35. 시스템 안정화 대책### 실제 안정화 대책 - 적절한 버퍼 유지와 불안정 요인 제거적절한 버퍼 유지를 위해 한계의 7할 운용을 수행하고 있다.   시스템 수용 능력의 70%를 상한선으로 해서 이를 넘어서면 서버를 추가하거나 메모리를 늘리는 등 임계치를 설정하는 방식을 취하고 있다.   불안정 요인을 제거하는 것과 관련해서는 SQL 부하대책, 메모리 누수 줄이기, 비정상 동작 시 자율제어가 있다.DB에 이상한 SQL을 날리면 바로 멈추면서 다운되어버린다.   부하가 높아질 듯한 SQL을 발행하지 않도록 하는 것은 시스템을 안정화시키기 위해 매우 중요하다.   애플리케이션 엔지니어는 자신의 서비스가 어떤 SQL을 발행하는지를 가능한 한 파악하고 부하가 높아질 만한 SQL을 발행한 경우 해당 용도를 위해 격리시킨 DB를 준비해서 거기로 SQL을 날리도록 해야 한다.   #### 이상 동작 시의 자율 제어이상 동작 시의 자율제어 대책으로 현재 세 가지가 있다.1. 자동 DoS 판정   - F5 어택이라고 하는, 리로드를 반복하는 행위가 있다.     - 이에 대한 대처방안으로 자동 DoS 판정을 수행하도록 해서 1시간에 특정 IP 주소로부터 다수의 요청이 오면, 당분간 403을 반환해서 액세스를 자율적으로 차단함으로써 비정상 액세스를 대처할 수 있다.2. 자동 재시작(AP 서버, 호스트 OS)   - 메모리 누수로 인해 스왑을 사용하기 시작하면서 부하가 증가하여 성능이 떨어진다면, 어느 정도 리소스를 지나치게 사용했다라고 판단했다면 웹 서버를 재시작한다.   - 또한 가상화되어 있는 호스트에서는 가상화되어 있는 OS 별로 재시작을 한다.3. 자동 쿼리제거(소요시간이 긴 SQL을 KILL)   - 자동 쿼리처리란 DB 서버에 어떤 쿼리가 실행되고 있는지를 10초에 한 번씩 파악해서 어느 정도 이상으로 시간이 경과한 쿼리를 강제적으로 KILL 하는 것이다.