# Chapter 13 다중성 확보, 시스템 안정화 - 100%에 근접한 가동률을 실현하는 원리---## 강의 34. 시스템 안정화### 시스템 안정화를 위한 상반관계안정성과 자원효율 간에는 상반관계가 있다.   또한 안정성과 속도도 상반관계가 있다.빠듯할 정도로 메모리를 튜닝해서 8GB 중에 7.5GB 정도까지 메모리를 사용하도록 설정했다고 가정하자.   처리해야 할 데이터량이 늘어나가나 갑자기 애플리케이션 버그가 발생하거나 메모리 누수가 발생해서 소비 메모리량이 갑자기 수백 MB 늘어나는 것은 드문 일이 아니다.   이처럼 메모리를 빠듯하게 튜닝하면 메모리가 늘어났을 때 곧바로 스왑을 사용하기 시작해서 성능이 저하되면서 서비스 장애로 이어지게 된다.또 하나는 CPU를 거의 한계에 다다를 정도로 사용하는 것이다.   이런 경우 서버 대수를 줄일 수 있어서 비용면에서는 유리하지만, 한계에 다다른 상태에서 1대에 장애가 발생하면 전체적으로 처리능력이 부족해져 요청을 다 처리하지 못하는 장애가 발생한다.이렇게 되지 않기 위해서는, 실제 메모리를 7할 정도 까지만 사용하거나 CPU를 7할 정도까지만 사용하는 등 어느정도 여유를 가지고 설계하는 것이 중요하다.### 시스템의 불안정 요인불안정 요인은 시스템 구성이 복잡도에 비례한다.- 애플리케이션/서비스 레벨 => 부하 증가  1. 기능 추가  2. 메모리 누수  3. 지뢰  4. 사용자의 액세스 패턴  5. 데이터량 증가  6. 외부연계 추가- 하드웨어 => 처리능력 저하  1. 메모리, HDD(Hard Disk Drive) 장애  2. NIC(Network Interface Card) 장애#### 1. 기능 추가, 2. 메모리 누수애플리케이션, 서비스 레벨에서 기능 추가는 물론 시스템의 불안정 요인으로, 새로운 기능을 추가하면 기 기능이 예상보다 무거워서 전체적인 부하가 늘어나 서비스가 다운되는 일은 과거에 여러 번 있었다.   메모리 누수도 상당히 불안정한 요인이다.#### 3. 지뢰지뢰는 특정 URL이 읽히면(지뢰를 밟으면) 아무리 시간이 지나도 응답이 오지 않아서 마치 지뢰처럼 장애의 원인이 되는 현상이다.   원인으로는 메모리 누수나 무한루프 등 다양한 요인이 있다.   이 지뢰의 원인을 찾는 것은 상당히 어려운 일이다.   왜냐하면 애플리케이션이 작동하고 있는데 지뢰를 밟으면 갑자기 시스템이 무거워지면서 다운되기 때문이다.   따라서 지뢰를 밟은 직후에 시스템이 다운되기 전에 찾아내지 못하면 어디에서 뭐가 지뢰가 되고 있는지 파악하기가 어려워진다.지뢰를 밟지 않도록 하기 위해서 애초에 지뢰를 만들지 않도록 하는 것도 물론 중요하지만, 좀처럼 완전히 제거할 수 있는 것도 아니므로 이런 지뢰를 다소 밟더라도 문제가 되지 않도록 설계하는 것도 중요하다.#### 4. 사용자의 액세스 패턴사용자의 액세스 패턴 변화도 부하가 증대되는 원인이다.액세스 변동도 흡수할 수 있도록 구성해두는 게 중요하다.   전형적으로 Squid와 같은 캐시 서버를 사이에 추가해서 게스트 사용자의 경우는 캐시를 반환할 수 있도록 해두는 방법이 있다.   캐시를 사용하면 리소스를 거의 사용하지 않고 요청에 대한 응답을 반환할 수 있으므로, 제대로 캐싱해서 게스트의 집중적인 액세스를 잘 처리할 수 있도록 해두는 것이 상당히 효과적이다.#### 5. 데이터량 증가1년 정도 서비스가 안정적으로 운영되고 있더라도 머지 않아 당초 예상했던 데이터량보다도 늘어나서 이것이 전체적인 부하의 증가로 이어져서 시스템이 불안정해지는 경우도 있다.데이터가 비정상적으로 늘어나기 시작했다는 것을 빨리 눈치채고 적절한 조치를 취하는 것이 매우 중요하다.#### 6. 외부연계 추가외부연계 추가라는 것은 광고 관련 웹 API나 Amazon 웹 API 등을 새롭게 추가하는 등 외부의 새로운 웹 API를 연결하는 것을 말한다.   외부연계를 늘리게 되면 외부시스템이 다운되어 있을 때 덩달아서 다운되는 형태가 되기 쉬우므로 외부시스템이 다운되거나 다운되지는 않더라도 부하가 높을 때에도 연계하고 있는 서비스가 영향을 받지 않고 충분한 속도로 다른 부분은 출력할 수 있도록 하는 등, 이러한 외부 노이즈에 견딜 수 있는 시스템을 구현하는 것도 중요하다.#### 7. 메모리, HDD 장애, 8. NIC 장애하드웨어의 능력이 저하되더라도 문제가 되지 않도록 해두는 것이 중요하다.   예를 들면 로드 밸런서에서 적절한 항목에 대해 헬스체크를 해서 하드웨어 장애로 이상이 생겼을 때 바로 문제가 발생한 서버로 요청이 전송되지 않도록 할 수 있다.   