# Chapter 10 프로세스와 스레드
## 10-3. 스레드
- **스레드(thread)** 는 실행의 단위이다.
  - 조금 더 정확하게 표현하자면, 스레드란 프로세스를 구성하는 실행의 흐름 단위이다.
  - 그리고 하나의 프로세스는 여러 개의 스레드를 가질 수 있다.
  - 스레드를 이용하면 하나의 프로세스에서 여러 부분을 동시에 실행할 수 있다.

### 프로세스와 스레드
- 전통적인 관점에서 하나의 프로세스는 한 번에 하나의 일만을 처리했다.
- '실행의 흐름 단위가 하나'라는 점에서 이렇게 실행되는 프로세스들은 **단일 스레드 프로세스** 라고 볼 수 있다.
- 하지만 **스레드** 라는 개념이 도입되면서 하나의 프로세스가 한 번에 여러 일을 동시에 처리할 수 있게 되었다.
  - 즉, 프로세스를 구성하는 여러 명렁어를 동시에 실행할 수 있게 된 것이다.
- 이런 점에서 스레드는 '프로세스를 구성하는 실행 단위'라고 볼 수 있다.
  - 스레드는 프로세스 내에서 각기 다른 스레드 ID, 프로그램 카운터 값을 비롯한 레지스터 값, 스택으로 구성된다.
  - 각자 프로그램 카운터 값, 스택을 가지고 있기에 스레드마다 각기 다른 코드를 실행할 수 있다.
  - 여기서 중요한 점은 프로세스의 스레드들은 실행에 필요한 최소한의 정보(프로그램 카운터를 포함한 레지스터, 스택)만을 유지한 채 프로세스 자원을 공유하며 실행된다는 점이다.
    - 프로세스의 자원을 공유한다는 것이 스레드의 핵심이다.
- 정리하면, 프로세스가 실행되는 프로그램이라면 스레드는 프로세스를 구성하는 실행의 흐름 단위이다.
  - 실제로 최근 많은 운영체제는 CPU에 처리할 작업을 전달할 때 프로세스가 아닌 스레드 단위로 전달한다.
  - 그리고 스레드는 프로세스 자원을 공유한 채 실행에 필요한 최소한의 정보만으로 실행된다.

> #### 여기서 잠깐) 리눅스 운영체제에서 프로세스 vs 스레드
> - 많은 운영체제가 프로세스와 스레드를 구분하지만, 프로세스와 스레드 간에 명확한 구분을 짓지 않는 운영체제도 있다.
>   - 대표적으로 리눅스가 그렇다.
>     - 리눅스는 프로세스와 스레드 모두 실행의 문맥(context of execution)이라는 점에서 동등하다고 간주하고 이 둘을 크게 구분 짓지 않는다.
>     - 프로세스와 스레드라는 말 대신 **테스트(task)** 라는 이름으로 통일하여 명명한다.
> - '프로세스와 스레드의 개념을 조금 더 분명이 구분 지을 필요가 있다'는 말에 대한 리눅스 운영체제 창시자 리누스 토르발스의 반응이다.
>   - '프로세스와 스레드를 별개의 것으로 구분할 이유가 없다. 전통적으로는 그렇게 해왔지만, 개인적으로 그것은 역사적인 짐과도 같다고 생각한다.'
>   - '프로세스와 스레드는 그냥 "실행의 문맥"일 뿐이다.'

### 멀티프로세스와 멀티스레드
- 컴퓨터는 실행 과정에서 여러 프로세스가 동시에 실행될 수 있고, 그 프로세스를 이루는 스레드는 여러 개 있을 수 있다.
  - 이때 여러 프로세스를 동시에 실행하는 것을 **멀티프로세스(multiprocess)** , 그리고 여러 스레드로 프로세스를 동시에 실행하는 것을 **멀티스레드(multithread)** 라고 한다.
- Q: 동일한 작업을 수행하는 단일 스레드 프로세스 여러 개를 실행하는 것과 하나의 프로세스를 여러 스레드로 실행하는 것은 무엇이 다를까?
- A: 예를 들어 "hello, os"를 화면에 출력하는 간단한 프로그램이 있다 가정하자.
  - 이 프로그램을 세 번 fork하여 실행하면 화면에는 "hello, os"가 세 번 출력된다.
  - 이 프로그램 내에 "hello, os"를 출력하는 스레드를 세 개 만들어 실행해도 화면에는 "hello, os"가 세 번 출력된다.
  - 이 둘은 무엇이 다를까?
    - 이 둘의 큰 차이는 프로세스끼리는 기본적으로 자원을 공유하지 않지만, 스레드끼리는 같은 프로세스 내의 자원을 공유한다는 점이다.
      - 프로세스를 fork하여 같은 작업을 하는 동일한 프로세스 두 개를 동시에 실행하면 코드 영역, 데이터 영역, 힙 영역 등을 비롯한 모든 자원이 복제되어 메모리에 적재된다.
      - 한 마디로 PID, 저장된 메모리 주소를 제외하면 모든 것이 동일한 프로세스 두 개가 통재로 메모리에 적재되는 것이다.
      - fork를 세 번, 네 번 하면 마찬가지로 메모리에는 같은 프로세스가 통쨰로 세 개, 네 개 적재된다.
      - 같은 프로그램을 실행하기 위해 메모리에 동일한 내용들이 중복해서 존재한다는 점에서 이는 낭비이다.
      - **이에 반해 스레드들은 각기 다른 스레드 ID, 프로그램 카운터 값을 포함한 레지스터 값, 스택을 가질 뿐 프로세스가 가지고 있는 자원을 공유한다.**
        - 즉, 같은 프로세스 내의 모든 스레드는 동일한 주소 공간의 코드, 데이터, 힙 영역을 공유하고, 열린 파일과 같은 프로세스 자원을 공유한다.
        - 여러 프로세스를 병행 실행하는 것보다 메모리를 더 효율적으로 사용할 수 있다.
        - 또한 서로 다른 프로세스들은 기본적으로 자원을 공유하지 않기 때문에 서로가 남남처럼 독립적으로 실행되는 반면, 스레드는 프로세스의 자원을 공유하기 떄문에 서로 협력과 통신에 유리하다.
        - 프로세스의 자원을 공유한다는 특성은 때론 단점이 될 수도 있는데, 멀티프로세서 환경에서는 하나의 프로세스에 문제가 생겨도 다른 프로세스에는 지장이 적거나 없지만, 멀티스레드 환경에서는 하나의 스레드에 문제가 생기면 프로세스 전체에 문제가 생길 수 있다.
          - 모든 스레드는 프로세스의 자원을 공유하고, 하나의 스레드에 문제가 생기면 다른 스레드도 영향을 받기 때문이다.

> #### 여기서 잠깐) 프로세스 간 통신
> - 프로세스끼리는 '기본적으로' 자원을 공유하지 않지만, 프로세스끼리도 충분히 자원을 공유하고 데이터를 주고받을 수 있다.
>   - 프로세스 간의 자원을 공유하고 데이터를 주고받는 것을 **프로세스 간 통신(IPC: Inter-Process Communication)** 이라 부른다.
> - '통신'이라는 말을 들으면 네트워크를 통해 데이터를 주고 받는 방식만을 떠올리기 쉽지만, 같은 컴퓨터 내의 서로 다른 프로세스나 스레드끼리 데이터를 주고받는 것도 통신으로 간주한다.
>   - 가령 프로세스 A는 'hello.txt' 파일에 새로운 값을 쓰는 프로세스, 프로세스 B는 'hello.txt' 파일을 읽는 프로세스 라면 두 프로세스는 'hello.txt' 파일 속 데이터를 주고받으므로 프로세스 간의 통신이 이루어져야 한다. 이를 **파일을 통한 프로세스 간 통신** 으로 볼 수 있다.
> - 또 프로세스들은 서로 공유하는 메모리 영역을 두어 데이터를 주고받을 수 있다.
>   - 프로세스들이 공유할 수 있는 메모리 영역을 **공유 메모리(shared memory)** 라고 한다.
> - 가령 프로세스 A와 B가 공유하는 메모리 영역 내에 'name'이라는 전역 변수가 있다고 가정해보자.
>   - 프로세스 A가 name 안에 값을 저장한 뒤, 프로세스 B가 name 변수 값을 읽어들인다면 두 프로세스는 전역 변수 name을 통해 서로 값을 주고받았다고 볼 수 있다.
> - 이 외에도 프로세스들은 소켓, 파이브 등을 통해 통신할 수 있다.
>   - 즉, 프로세스들끼리 데이터를 교환하는 것은 모든 자원을 처음부터 공유하고 있는 스레드에 비하면 다소 까다로운 것일 뿐 불가능한 것은 아니다. 

---