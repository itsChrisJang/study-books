# Chapter 06. 메모리와 캐시 메모리
## 6-2. 메모리의 주소 공간
- **물리 주소**는 메모리 하드웨어가 사용하는 주소이다.
- **논리 주소**는 CPU와 실행 중인 프로그램이 사용하는 주소이다.

### 물리 주소와 논리 주소
- Q : "CPU와 실행 중인 프로그램은 현재 메모리 몇 번지에 무엇이 저장되어 있는지 다 알고 있을까요?"
- A : 그렇지 않다.
  - CPU와 메모리에 저장되어 실행중인 프로그램은 메모리 몇 번지에 무엇이 저장되어 있는지 다 알지 못한다.
    - 그 이유는 메모리에 저장된 정보는 시시각각 변하기 때문이다.
    - 메모리에는 새롭게 실행되는 프로그램이 시시때때로 적재되고, 실행이 끝난 프로그램은 삭제된다.
    - 게다가 같은 프로그램을 실행하더라도 실행할 때마다 적재되는 주소가 달라질 수 있다.
    
#### 물리 주소(physical address)
- 정보가 실제로 저장된 하드웨어상의 주소를 의미한다.

#### 논리 주소(logical address)
- 실행 중인 프로그램 각각에게 부여된 0번지부터 시작되는 주소를 의미한다.
- 새로운 프로그램이 언제든 적재될 수 있고, 실행되지 않는 프로그램은 언제든 메모리에서 사라질 수 있기 때문에 다른 프로그램들의 물리 주소가 무엇인지 굳이 알 필요가 없다.
  - 그렇기 때문에 실행 중인 프로그램들은 각각 모두 물리 주소가 아닌 0번지부터 시작되는 자신만을 위한 주소인 논리 주소를 가지고 있다.
- CPU는 이 논리 주소를 받아들이고, 해석하고, 연산한다.

#### 정리
- 메모리가 사용하는 주소는 하드웨어상의 실제 주소인 물리 주소이고, CPU와 실행 중인 프로그램이 사용하는 주소는 각각의 프로그램에 부여된 논리 주소이다.
- 그렇지만, CPU가 이해하는 주소가 논리 주소라고는 해도 CPU가 메모리와 상호작용하려면 논리 주소와 물리 주소 간의 변환이 이루어져야 한다.
  - 논리 주소와 물리 주소간에 어떠한 변환도 이루어지지 않는다면 CPU와 메모리는 서로 이해할 수 없는 주소 체계를 가지고 서로 상호작용할 수 없게 된다.

#### 논리 주소 물리 주소로 변환하기
- 논리 주소와 물리 주소간의 변환은 CPU와 주소 버스 사이에 위치한 **메모리 관리 장치(MMU: Memory Management Unit)** 라는 하드웨어에 의해 수행된다.
- MMU는 CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더하여 논리 주소를 물리 주소로 변환한다.
- EX)
  - 현재 베이스 레지스터에 15000이 저장되어 있고 CPU가 발생시킨 논리 주소가 100번지라면 이 논리 주소는 물리 주소 15100번지(100+15000)로 변환된다.
- **베이스 레지스터**는 프로그램의 가장 작은 물리 주소, 즉 프로그램의 첫 물리 주소를 저장하는 셈이고, **논리 주소**는 프로그램의 시작점으로부터 떨어진 거리인 셈이다. 

### 메모리 보호 기법
- 다른 프로그램의 영역을 침범할 수 있는 명령어는 위험하기 때문에 논리 주소 범위를 벗어나는 명령어 실행을 방지하고 실행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록 보호할 방법이 필요하다.
  - 이는 **한계 레지스터(limit register)** 라는 레지스터가 담당한다.
- 베이스 레지스터가 실행 중인 프로그램의 가장 작은 물리 주소를 저장한다면, 한계 레지스터는 논리 주소의 최대 크기를 저장한다.
- 즉, 프로그램의 물리 주소 범위는 베이스 레지스터 값 이상, 베이스 레지스터 값 + 한계 레지스터 값 미만이 된다.
- CPU가 접근하려는 논리 주소는 한계 레지스터가 저장한 값보다 커서는 안된다.
  - 한계 레지스터보다 높은 주소 값에 접근하는 것은 곧 프로그램의 범위에 벗어난 메모리 공간에 접근하는 것과 같기 때문이다.
  - EX)
    - 베이스 레지스터에 100, 한계 레지스터에 150이 저장되어 있다 가정하자.
    - 이는 물리 주소 시작점이 100번지, 프로그램의 크기(논리 주소의 최대 크기)는 150임을 의미한다.
    - 따라서 이 프로그램은 150번지를 넘어서는 논리 주소를 가질 수 없다.
- CPU는 메모리에 접근하기 전에 접근하고자 하는 논리 주소가 한계 레지스터보다 작은지를 항상 검사한다.
  - 만약 CPU가 한계 레지스터보다 높은 논리 주소에 접근하려고 하면 인터럽트(트렙)를 발생시켜 실행을 중단한다.
  - 이러한 방식으로 실행 중인 프로그램의 독립적인 실행 공간을 확보하고 하나의 프로그램이 다른 프로그램을 침범하지 못하게 보호할 수 있다.

---
