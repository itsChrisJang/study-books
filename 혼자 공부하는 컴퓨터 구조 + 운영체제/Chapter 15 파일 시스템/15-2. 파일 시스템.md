# Chapter 15 파일 시스템
## 15-2. 파일 시스템
- 이번 절에서는 파일 시스템이 파일과 디렉터리를 보조기억장치에 어떻게 할당하고 접근하는지에 관한 이론적인 내용을 먼저 학습하고, 이러한 이론을 기반으로 만들어진 대표적인 파일 시스템 **FAT 파일 시스템과 유닉스 파일 시스템** 을 학습해보자.

### 파티셔닝과 포매팅
- 이제 막 공장에서 생산되어 한 번도 사용된 적이 없는 새 하드 디스크 또는 SSD가 있다고 가정하자.
  - 이 보조기억장치에서 곧바로 파일을 생성하거나 저장할 수 없다.
  - 왜냐하면 보조기억장치를 사용하려면 **파티션 을 나누는 작업(파티셔닝)과 포맷 작업(포매팅)** 을 거쳐야 하기 때문이다.
- **파티셔닝(partitioning)** 은 저장 장치의 논리적인 영역을 구획하는 작업을 의미한다.
  - 가령 엄청나게 커다란 서랍이 있다고 생각하자.
  - 커다란 서랍 안에 마구잡이로 물건들을 보관하면 필요한 물건을 정돈하는 게 쉽지 않다.
  - 하지만 서랍 안에 다음과 같이 칸막이를 설치하여 영역을 나누면 물건들을 정리하기가 조금 더 수월하다.
    - 이렇게 칸막이로 영역을 나누는 작업이 바로 **파티셔닝** 이다.
    - 하드 디스크나 SSD처럼 용량이 큰 저장 장치를 하나 이상의 논리적인 단위로 구획하는 것이다.
    - 그리고 이렇게 파티셔닝 작업을 통해 나누어진 영역 하나하나를 **파티션(partition)** 이라고 한다.
- 포맷하는 작업, 즉 **포매팅(formatting)** 은 저장 장치를 완전히 삭제하는 것으로 알고 있는 사람들이 많지만, 사실 이는 완벽하게 정확한 표현이라고 보기는 어렵다.
  - 포매팅이란 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지를 결정하고, 새로운 데이터를 쓸 준비를 하는 작업을 의미한다.
  - 즉, 어떤 종류의 파일 시스템을 사용할지는 바로 이때 결정난다.

### 파일 할당 방법
- 하드 디스크의 포매팅까지 끝냈다고 가정하자. 이제 이 저장 장치에 사용할 파일을 저장해보자.
  - 운영체제는 파일과 디렉터리를 **블록(block)** 단위로 읽고 쓴다.
  - 즉, 하나의 파일이 보조기억장치에 저장될 때는 하나 이상의 블록에 걸쳐 저장된다.
  - 하드 디스크의 가장 작은 저장 단위는 섹터이지만, 운영체제는 하나 이상의 섹터를 블록이라는 단위로 묶은 뒤 블록 단위로 파일과 디렉터리를 관리한다.
  - 파일 시스템이 모든 섹터를 관리하기에는 개수가 너무 많고 크기도 작기 때문이다.
- 파일을 보조기억장치에 할당하는 방법에는 크게 두 가지가 있다.
  - **연속 할당과 불연속 할당** 이다.
    - 불연속 할당에는 크게 **연결 할당, 색인 할당** 이 있다.

#### 연속 할당
- **연속 할당(contiguous allocation)** 은 가장 단순한 방식이다.
  - 이름 그대로 보조기억장치 내 연속적인 블록에 파일을 할당하는 방식이다.
  - 가령 블록을 세 개, 두 개, 다섯 개 차지하는 정도의 크기를 가진 파일 a, b, c가 있을 때 이 파일들은 연속적으로 할당된다.
- 연속으로 할당된 파일에 접근하기 위해서는 파일의 첫 번째 블록 주소와 블록 단위의 길이만 알면 된다.
  - 그렇기에 연속 할당을 사용하는 파일 시스템에서는 다음과 같이 디렉터리 엔트리에 파일 이름과 더불어 첫 번째 블록 주소와 블록 단위의 길이를 명시한다.
- 연속 할당 방식은 파일을 그저 연속적으로 저장하는 방식이기에 구현이 단순하다는 장점이 있지만, **외부 단편화** 를 야기한다는 치명적인 문제가 있다.

#### 연결 할당
- 연속 할당의 문제를 해결할 수 있는 방식이 **연결 할당(linked allcation)** 이다.
  - 연결 할당은 각 블록 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당하는 방식이다.
  - 즉, 파일을 이루는 데이터를 연결 리스트로 관리한다.
  - 연결 할당은 불연속 할당의 일종이기에 파일이 여러 블록에 흩어져 저장되어도 무방하다.
- 연결 할당은 외부 단편화 문제를 해결하지만 이 또한 단점이 있다.
  1. **반드시 첫 번째 블록부터 하나씩 차례대로 읽어야 한다.**
    - 첫 번째 단점은 파일의 중간 부분부터 접근하고 싶어도 반드시 파일의 첫 번째 블록부터 접근하여 하나씩 차례대로 읽어야 한다는 점이다.
    - 다시 말해 파일 내 임의의 위치에 접근하는 속도, 즉 **임의 접근(random access)** 속도가 매우 느리다.
      - 예를 들어 i번째 블록에 접근하기 위해서는 반드시 첫 번째 블록부터 i번째 블록까지 일일이 순서대로 접근해야만 한다.
      - 이는 성능 면에서 상당히 비효율적이다.
  2. **하드웨어 고장이나 오류 발생 시 해당 블록 이후 블록은 접근할 수 없다.**
    - 두 번째 단점은 하나의 블록 안에 파일 데이터와 다음 블록 주소가 모두 포함되어 있다 보니, 하드웨어 고장이나 오류로 인해 파일을 이루는 블록에 하나라도 문제가 발생하면 그 블록 이후의 블록에 접근할 수 없다는 것이다.
    - 하드 디스크는 굉장히 정교하고 고장에 예민한 장치이다.
    - 하드 디스크 헤드는 플래터 위에 대단히 미세한 간격으로 떨어져 있는 만큼 층격을 받으면 자칫 헤드가 플래터에 충돌하여 데이터를 손상 시킬 수 있다.
    - 그래서 오늘날에는 위 내용을 그대로 구현하기보다는 이를 조금 변형하여 사용한다.
      - 연결 할당을 변형한 대표적인 파일 시스템이 오늘날까지도 많이 사용하는 FAT 파일 시스템이다.

#### 색인 할당

### 파일 시스템 살펴보기
#### FAT 파일 시스템
#### 유닉스 파일 시스템

---