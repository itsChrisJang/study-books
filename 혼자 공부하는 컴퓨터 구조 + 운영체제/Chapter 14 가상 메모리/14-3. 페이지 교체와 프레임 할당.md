# Chapter 14 가상 메모리
## 14-3. 페이지 교체와 프레임 할당
- 가상 메모리를 통해 작은 물리 메모리보다 큰 프로세스도 실행할 수 있다고는 하지만 그럼에도 불구하고 여전히 물리 메모리의 크기는 한정되어 있다.
  - 운영체제는 프로세스들이 한정된 메모리를 효율적으로 이용할 수 있도록 기존에 메모리에 적재된 불필요한 페이지를 선별하여 보조기억장치로 내보낼 수 있어야 하고, 프로세스들에 적절한 수의 프레임을 할당하여 페이지를 할당할 수 있게 해야 한다.

### 요구 페이징
- 프로세스를 메모리에 적재할 때 처음부터 모든 페이지를 적재하지 않고 필요한 페이지만을 메모리에 적재하는 기법을 **요구 페이징(demand paging)** 이라고 한다.
  - 이름 그대로 실행에 요구되는 페이지만 적재하는 기법이다.
- 요구 페이징의 기본적인 양상
  1. CPU가 특정 페이지에 접근하는 명령어를 실행한다.
  2. 해당 페이지가 현재 메모리에 있을 경우(유효 비트가 1일 경우) CPU는 페이지가 적재된 프레임에 접근한다.
  3. 해당 페이지가 현재 메모리에 없을 경우(유효 비트가 0일 경우) 페이지 폴트가 발생한다.
  4. 페이지 폴트 처리 루틴은 해당 페이지를 메모리로 적재하고 유효 비트를 1로 설정한다.
  5. 다시 (i) 번을 수행한다.
- 참고로 아무런 페이지도 메모리에 적재하지 않은 채 무작정 실행부터 할 수도 있다.
  - 이 경우 프로세스의 첫 명령어를 실행하는 순간부터 페이지 폴트가 계속 발생하게 되고, 실행에 필요한 페이지가 어느 정도 적재된 이후부터는 페이지 폴트 발생 빈도가 떨어진다.
  - 이를 **순수 요구 페이징(pure demand paging)** 기법이라 한다.
- 요구 페이징 시스템이 안정적으로 작동하려면 필연적으로 다음 두 가지룰 해결해야 한다.
  - 하나는 **페이지 교체** 이고, 다른 하나는 **프레임 할당** 이다.
- 요구 페이징 기법으로 페이지들을 적재하다 보면 언젠가 메모리가 가득 차게 된다.
  - 이때는 당장 실행에 필요한 페이지를 적재하기 위해 메모리에 적재된 페이지를 보조기억장치로 내보내야 한다.
- 메모리에 적재된 많고 많은 페이지 중 어떤 페이지를 보내는 것이 최선일까?
  - 이를 결졍하는 방법이 페이지 교체 알고리즘이다.
  - 즉, 쫓아낼 페이지를 결정하는 방법을 **페이지 교체 알고리즘** 이라 한다.

### 페이지 교체 알고리즘
- 좋은 페이지 교체 알고리즘은 무엇일까?
  - 일반적으로 페이지 폴트를 가장 적게 일으키는 알고리즘을 좋은 알고리즘으로 평가한다.
  - 페이지 폴트가 일어나면 보조기억장치로부터 필요한 페이지를 가져와야 하기 떄문에 메모리에 적재된 페이지를 가져오는 것보다 느려지기 때문이다.
- 가령 한 알고리즘을 통해 고른 페이지를 스왑 아웃시켰을 때 페이지 폴트가 자주 발생하면 이는 좋은 알고리즘이 아니다.
  - "한 페이지 교체 알고리즘을 선택했더니 페이지 폴트가 자주 발생했다."는 말은 "보조기억장치로 내쫓을 페이지를 잘못 골랐다"는 뜻으로, 내보내면 안 되는 페이지를 보조기억장치로 내보냈다는 의미와 같기 때문이다.
  - 반면, 어떤 알고리즘을 통해 고른 페이지를 스왑 아웃시켜도 페이지 폴트가 자주 발생하지 않는다면 이는 컴퓨터의 성능 저하를 방지하는 좋은 알고리즘으로 평가할 수 있다.
- 그렇기에 페이지 교체 알고리즘을 제데로 이해하려면 **페이지 폴트 횟수** 를 알 수 있어야 한다.
  - 그리고 페이지 폴트 횟수는 **페이지 참조열(page reference string)** 을 통해 알 수 있다.

#### FIFO 페이지 교체 알고리즘(First-In First-Out Page Replacement Algorithm)
- 이름 그대로 가장 먼저 올라온 페이지부터 내쫓는 방식으로, 쉽게 말해 "오래 머물렀다면 나가라"는 알고리즘이다.
- FIFO 페이지 교체 알고리즘은 아이디어와 구현이 간단하지만, 마냥 좋은 것은 아니다.
  - 프로그램 실행 초기에 적재된 페이지 속에는 프로그램 실행 초기에 잠깐 실행되다가 이후에 사용되지 않을 페이지도 있겠지만, 프로그램 실행 내내 사용될 내용을 포함하고 있을 수도 있다.

#### 최적 페이지 교체 알고리즘(optimal page replacement algorithm)
- 최적 페이지 교체 알고리즘은 CPU에 의해 참조되는 횟수를 고려하는 페이지 교체 알고리즘이다.
  - 메모리에 오랫동안 남아야 할 페이지는 자주 사용될 페이지고, 반대로 메모리에 없어도 될 페이지는 오랫동안 사용되지 않을 페이지인데, 오랜 기간 메모리에 있었던 페이지라고 해서 보조기억장치로 내쫓는 건 비합리적이라고 볼 수 있다.

#### LRU 페이지 교체 알고리즘


### 스래싱과 프레임 할당

---