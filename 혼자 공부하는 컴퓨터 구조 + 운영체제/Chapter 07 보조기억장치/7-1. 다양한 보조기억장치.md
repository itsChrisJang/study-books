# Chapter 07. 보조기억장치
## 7-1. 다양한 보조기억장치
- 가장 대중적인 보조기억장치는 하드 디스크와 플래시 메모리이다.
  - 플래시 메모리는 우리가 흔히 사용하는 USB 메모리, SD 카드, SSD와 같은 저장 장치를 말한다. 

### 하드 디스크
- **하드디스크(HDD: Hard Disk Drive)**
  - 자기적인 방식으로 데이터를 저장하는 보조기억장치이다.
  - **자기 디스크(magnetic disk)** 의 일종으로 지칭하기도 한다.
- **플래터(platter)**
  - 하드 디스크에서 실질적으로 데이터가 저장되는 곳으로 동그란 원판 구조이다.
  - 하드 디스크는 자기적인 방식으로 데이터를 저장하여 플래터는 자기 물질로 덮여 있어 수많은 N극과 S극을 저장한다.
    - N극과 S극은 0과 1의 역할을 수행한다.
- 그 플래터를 회전시키는 구성 요소를 **스핀들(spindle)** 이라 한다.
  - 스핀들이 플래터를 돌리는 속도는 분당 회전수를 나타내는 **RPM(Revolution Per Minute)** 라는 단위로 표현된다.
  - 가령 RPM이 15,000인 하드 디스크는 1분에 15,000바퀴를 회전하는 하드 디스크이다. 
- 플래터를 대상으로 데이터를 읽고 쓰는 구성 요소는 **헤드(head)** 이다.
  - 헤드는 플래터 위에서 미세하게 떠 있는 채로 데이터를 읽고 쓰는, 마치 바늘같이 생긴 부품이다.
  - 그리고 헤드를 원하는 위치로 헤드를 이동시키는 **디스크 암(disk arm)** 에 부착되어 있다.
- CD나 LP에 비해 하드 디스크는 훨씬 더 많은 양의 데이터를 저장해야 하므로 일반적으로 여러 겹의 플래터로 이루어져 있고 플레터 양면을 모두 사용할 수 있다.
- 양면 플래터를 사용하면 위아래로 플래터당 두 개의 헤드가 사용된다.

#### 플래터에 데이터가 저장되는 방법
- 플래터는 **트랙(track)** 과 **섹터(sector)** 라는 단위로 데이터를 저장한다.
  - 섹터는 하드 디스크의 가장 작은 전송 단위이다.
  - 하나의 섹터는 일반적으로 512바이트 정도의 크기를 가지고 있지만, 정확한 크기는 하드 디스크에 따라 차이가 있다.
  - 하나 이상의 섹터를 묶어 **블록(block)** 이라 표현하기도 한다.
- 여러 겹의 플래터 상에서 같은 트랙이 위치한 곳을 모아 연결한 논리적 단위를 **실린더(cylinder)** 라고 부른다.
  - 쉽게 말해 한 플래터를 동심원으로 나눈 공간은 트랙, 같은 트랙끼지 연결한 원통 모양의 공간은 실린더라고 부른다.
- 연속된 정보는 보통 한 실린더에 기록된다.
  - 연속된 정보를 하나의 실린더에 기록하는 이유는 디스크 암을 움직이지 않고도 바로 데이터에 접근할 수 있기 때문이다.
- 하드 디스크가 저장된 데이터에 접근하는 시간은 크게 **탐색 시간, 회전 지연, 전송 시간** 으로 나뉜다.
  - **탐색 시간(seek time)** 은 접근하려는 데이터가 저장된 트랙까지 헤드를 이동시키는 시간을 의미한다.
  - **회전 지연(rotational latency)** 은 헤드가 있는 곳으로 플래터를 회전시키는 시간을 의미한다.
  - **전송 시간(transfer time)** 은 하드 디스크와 컴퓨터 간에 데이터를 전송하는 시간을 의미한다.
- 제프 딘의 '프로그래머가 꼭 알아야 할 컴퓨터 시간'

|                             |             |
|-----------------------------|-------------| 
| L1 캐시 참조 시간                 | 0.5ns       |
| L2 캐시 참조 시간                 | 5ns         |
| 메모리 참조 시간                   | 7ns         |
| 메모리에서 1MB를 순차적으로 읽는 시간      | 250,000ns    |
| (하드) 디스크 탐색 시간              | 10,000,000ns          |
| (하드) 디스크에서 1MB를 순차적으로 읽는 시간 | 30,000,000ns          |
| 한 패킷이 캘리포니아에서 네덜란드까지 왕복하는 시간 | 150,000,000ns              |

- 탐색 시간가 회전 지연을 단축 시키기 위해서는 플래터를 빨리 돌려 RPM을 높이는 것도 중요하지만 참조 지역성, 즉 접근하려는 데이터가 플래터 혹은 헤드를 조금만 옮겨도 접근할 수 있는 곳에 위치해 있는 것도 중요하다.
> #### 다중 헤드 디스크와 고정 헤드 디스크
> - 플래터의 한 면당 헤드가 하나씩 달려 있는 하드 디스크를 **단일 헤드 디스크(single-head disk)** 라고 부른다
> - 반면, 헤드가 트랙별로 여러 개 달려 있는 하드 디스크도 있는데 이를 **다중 헤드 디스크(multiple-head disk)** 라고 부른다.
> - 다중 헤드 디스크는 트랙마다 헤드가 있기 때문에 탐색 시간이 들지 않는다.
> - 따라서 다중 헤드 디스크는 탐색 시간이 0이다.
> - 이런 점에서 헤드를 움직일 필요가 없는 다중 헤드 디스크를 **고정 헤드 디스크(fixed-head disk)** 라고 부른다.
> - 반대로 헤드를 데이터가 있는 곳까지 움직여야 하는 단일 헤드 디스크를 **이동 헤드 디스크(movable-head disk)** 라고 부른다.

### 플래시 메모리
- 하드 디스크는 최근에 많이 사용하는 보조기억장치이지만, **플래시 메모리(flash memory)** 기반의 보조기억장치 또한 많이 사용된다.
  - 우리가 흔히 사용하는 USB 메모리, SD 카드, SSD가 모두 플래시 메모리 기반의 보조기억장치이다.
- 플래시 메모리는 전기적으로 데이터를 읽고 쓸 수 있는 반도체 기반 저장 장치이다.
  - 사실 플래시 메모리는 보조기억장치 범주에만 속한다기보다 다양한 곳에서 널리 사용하는 저장 장치로 보는것이 옳다.
  - 주기억장치 중 하나인 ROM에도 사용되고, 우리가 일상적으로 접하는 거의 모든 전자 제품 안에 플래시 메모리가 내장되어 있다고 봐도 무방하다.
> #### 두 종류의 플래시 메모리
> - 플래시 메모리에는 크게 **NAND 플래시 메모리** 와 **NOR 플래시 메모리** 가 있다. 
> - NAND 플래시와 NOR 플래시는 각각 NAND 연산을 수행하는 회로(NAND 게이트)와 NOR 연산을 수행하는 회로(NOR 게이트)를 기반으로 만들어진 메모리를 뜻한다.
> - 이 둘 중 대용량 저장 장치로 많이 사용되는 플래시 메모리는 NAND 플래시 메모리이다.
> - **플래시 메모리는 특별한 언급이 없는 이상 NAND 플래시 메모리를 지칭한다 봐도 무방하다.**
- 플래시 메모리에는 **셀(cell)** 이라는 단위가 있다. 
- 셀이란 플래시 메모리에서 데이터를 저장하는 가장 작은 단위이다.
  - 이 셀이 모여 MB, GB, TB 용량을 갖는 저장 장치가 된다.
  - 이때 하나의 셀에 몇 비트를 저장할 수 있느냐에 따라 플래시 메모리 종류가 나뉜다.
    - 한 셀에 1비트를 저장할 수 있는 플래시 메모리를 **SLC(Single Level Cell)** 타입
    - 한 셀에 2비트를 저장할 수 있는 플래시 메모리를 **MLC(Multiple Level Cell)** 타입
    - 한 셀에 3비트를 저장할 수 있는 플래시 메모리를 **TLC(Triple Level Cell)** 타입
> #### 여기서 잠깐
> - Q : 플래시 메모리도 수명이 있나요?
> - A : 플래시 메모리도 수명이 있다.
>   - 플래시 메모리뿐만 아니라 하드 디스크 또한 수명이 있다.
>   - 우리가 사용하는 USB 메모리, SSD, SD 카드는 수명이 다하면 더 이상 저장 장치로써 사용이 불가능하다.
>   - 종이에 연필로 쓰고 지우개로 지우고를 반복하다 보면 결국 종이가 찢어지는 것처럼 한 셀에 일정 횟수 이상 데이터를 쓰고 지우면 그 셀은 더 이상 데이터를 저장할 수 없기 때문이다.

#### SLC 타입
- SLC 타입은 한 셀로 두 개의 정보를 표현할 수 있다.
- 홀로 거주하는 집에 제약 없이 출입이 가능하듯 SLC 타입은 MLC나 TLC 타입에 비해 비트의 빠른 입출력이 가능하다.
- 수명도 MLC나 TLC 타입보다 길어서 수만에서 수십만 번 가까이 데이털르 쓰고 지우고를 반복할 수 있다.
- 하지만 SLC 타입은 용량 대비 가격이 높다.
  - 마치 혼자 살면서 감당해야 할 주거 비용이 커지는 것과 같다.
- 보통 기업에서 데이터를 읽고 쓰기가 매우 많이 반복되며 고성능의 빠른 저장 장치가 필요한 경우 사용된다.

#### MLC 타입
- MLC 타입은 한 셀로 네 개의 정보를 표현할 수 있다.
- SLC 타입보다 일반적으로 수명이 떨어지지만, 한 셀에 두 비트씩 저장할 수 있다는 점에서 MLC 타입은 SLC 타입보다 대용화하기 유리하다.
- 집의 개수가 같다면 한 집에 한 명씩 사는 것보다 한 집에 두 명 씩 사는 것이 훨씬 더 많은 사람을 수용할 수 있는 것과 같은 이치이다.
- 두 명이 한집에서 주거 비용을 나눠 내면 혼자 감당해야 하는 주거 비용이 저렴해지듯 MLC 타입은 SLC 타입보다 용량 대비 가격이 저렴하다.
- 시중에서 사용되는 많은 플래시 메모리 저장 장치들이 MLC 타입(혹은 후술할 TLC 타입)으로 만들어진다.

#### TLC 타입
- 한 셀당 3비트씩 저장할 수 있는 TLC 타입은 한 셀로 여덞개의 정보를 표현할 수 있다.
  - 대용량화 하기 유리하다.
- 일반적으로 SLC나 MLC 타입보다 수명과 속도가 떨어지지만 용량 대비 가격이 저렴하다.

#### 정리
- 같은 용량의 플래시 메모리 저장 장치라고 할지라도 셀의 타입에 따라 수명, 가격, 성능이 다르다.
- 썼다 지우기를 자주 반복해야 하는 경우 혹은 높은 성능을 원하는 경우에는 고가의 SLC 타입을 선택하는 것이 좋고, 저가의 대용량 저장 장치를 원한다면 TLC 타입, 그 중간을 원한다면 MLC 타입을 선택하는 것이 좋다.

| 구분       | SLC  | MLC  | TLC  |
|----------|------|------|------|
| 셀당 bit   | 1bit | 2bit | 3bit |
| 수명       | 길다   | 보통   | 짧다   |
| 읽기/쓰기 속도 | 빠르다  | 보통   | 느리다  |
| 용량 대비 가격 | 높다   | 보통   | 낮다   |
- 셀들이 모여 만들어진 단위를 **페이지(page)** 그리고 페이지가 모여 만들어진 단위를 **블록(block)** 이라 한다.
- 블록이 모여 **플레인(plane)** 그리고 플레인이 모여 **다이(die)** 가 된다.
- 플래시 메모리에서 읽기와 쓰기는 페이지 단위로 이루어진다.
  - 하지만 삭제는 페이지보다 큰 블록 단위로 이루어진다.
  - 읽기/쓰기 단위와 삭제 단위가 다르다는 것이 플래시 메모리의 가장 큰 특징이다.
- 이때 페이지는 세 개의 상태를 가질 수 있다.
  1. **Free 상태**
     - 어떠한 데이터도 저장하고 있지 않아 새로운 데이터를 저장할 수 있는 상태
  2. **Valid 상태**
     - 이미 유효한 데이터를 저장하고 있는 상태
  3. **Invalid 상태**
     - 쓰레기값이라 부르는 유요하지 않은 데이터를 젖아하고 있는 상태
  - 플래시 메모리는 하드 디스크와는 달리 덮어쓰기가 불가능하여 Valid 상태인 페이지에는 새 데이터를 저장할 수 없다. 

#### 플래시 메모리의 간단한 동작
1. X 라는 블록이 네 개의 페이지로 구성되어 있다.
2. A와 B라는 데이터가 저장 되어 있다.

| .  | .   | 
|----|-----|
| A  | B   |
|    |     |
3. 새롭게 저장된 C와 기존에 저장되어 있던 B는 그대로 둔 채 기존의 A만을 A'로 수정하고 싶다.

| .   | .   | 
|-----|-----|
| A   | B   |
| C   |     |
4. 플래시 메모리에서 덮어쓰기는 불가능하기 때문에 기존에 저장된 A는 Invalid 상태가 되어 더 이상 값이 유효하지 않은 쓰레기 값이 되고, 새로운 A' 데이터가 저장된다.

| .          | .   | 
|------------|-----|
| A(Invalid) | B   |
| C          | A'   |
5. A와 같이 쓰레기 값을 저장하고 있는 공간은 사용하지 않는 공간인데도 불구하고 용량을 차지하고 있다. 이는 **용량 낭비** 이다. 그렇지만 플래시 메모리에서 삭제는 블록 단위로 수행되기 때문에 A만 지울 수 없다. 

| .          | .   | 
|------------|-----|
| A(Invalid) | B   |
| C          | A'   |
6. 최근 SSD를 비롯한 플래시 메모리는 이런 쓰레기 값을 정리하기 위해 **가비지 컬렉션(garbage collection)** 기능을 제공한다.
7. 가비지 컬렉션은 (1) 유효한 페이지들만 새로운 블록으로 복사한 뒤, (2) 기존의 블록을 삭제한다.

블록 X

| .          | .   | 
|------------|-----|
| A(Invalid) | B   |
| C          | A'   |

(1) valid 페이지 복사<br/>
(2) 기존 블록 삭제

블록 Y

| .          | .   | 
|------------|-----|
| | B   |
| C          | A'   |
---
