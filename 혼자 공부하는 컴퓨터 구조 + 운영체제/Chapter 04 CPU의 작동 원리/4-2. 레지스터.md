# Chapter 04. CPU의 작동 원리
## 4-2. 레지스터
- 프로그램 속 명령어와 데이터는 실행 전후로 반드시 레지스터에 저장된다.
  - 따라서 레지스터에 저장된 값만 잘 관찰해도 프로그램의 실행 흐름을 파악할 수 있다.
  - 즉, 레지스터 속 값을 유심히 관찰하면 프로그램을 실행할 때 CPU 내에서 무슨 일이 벌어지고 있는지, 어떤 명령어가 어떻게 수행되는지 알 수 있다.
### 반드시 알아야 할 레지스터
- 많은 CPU가 공통으로 포함하고 있는 여덞개의 레지스터
  1. **프로그램 카운터(PC: Program Counter)**
     - 메모리에서 가져올 명령어의 주소, 즉 메모리에서 읽어 들일 명령어의 주소를 저장한다.
     - 프로그램 카운터를 **명령어 포인터(IP: Instruction Pointer)** 라고 부르기도 한다.
  2. **명령어 레지스터(IR: Instruction Register)**
     - 해석할 명령어, 즉 방금 메모리에서 읽어 들인 명령어를 저장하는 레지스터이다.
     - 제어장치는 명령어 레지스터 속 명령어를 받아들이고 이를 해석한 뒤 제어 신호를 내보낸다.
  3. **메모리 주소 레지스터(MAR: Memory Address Register)**
     - 메모리의 주소를 저장하는 레지스터이다.
     - CPU가 읽어 들이고자 하는 주소 값을 주소 버스로 보낼 때 메모리 주소 레지스터를 거치게 된다.
  4. **메모리 버퍼 레지스터(MBR: Memory Buffer Register = MDR: Memory Data Register)**
     - 메모리와 주고받을 값(데이터와 명령어)을 저장하는 레지스터이다.
     - 즉, 메모리에 쓰고 싶은 값이나 메모리로부터 전달받은 값은 메모리 버퍼 레지스터를 거친다.
     - CPU가 주소 버스로 내보낼 값이 메모리 주소 레지스터를 거친다면, 데이터 버스로 주고받을 값은 메모리 버퍼 레지스터를 거칩니다.
  5. **플래그 레지스터(flag register)**
     - ALU 연산 결과에 따른 플래그를 플래그 레지스터에 저장한다고 했는데 **플래그 레지스터** 는 연산 결과 또는 CPU 상태에 대한 부가적인 정보를 저장하는 레지스터이다.
  6. **범용 레지스터(general purpose register)**
     - 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터이다.
     - 메모리 버퍼 레지스터는 데이터 버스로 주고받을 값만 저장하고, 메모리 주소 레지스터는 주소 버스로 내보낼 주소값만 저장하지만, 범용 레지스터는 데이터와 주소를 모두 저장할 수 있다.
     - 일반적으로 CPU 안에는 여러 개의 범용 레지스터들이 있고, 현대 대다수 CPU는 모두 범용 레지스터를 가지고 있다.
  7. **스택 포인터(stack pointer)**
     - 스택 주소 지정 방식이라는 주소 지정 방식에 사용된다.
  8. **베이스 레지스터(base register)**
     - 변위 주소 지정 방식이라는 주소 지정 방식에 사용된다.

### 특정 레지스터를 이용한 주소 지정 방식(1): 스택 주소 지정 방식
- 스택 주소 지정 방식
  - 스택과 스택 포인터를 이용한 주소 지정 방식이다.
    - **스택 포인터**
      - 스택의 꼭대기를 가리키는 레지스터
      - 즉, 스택에 마지막으로 저장한 값의 위치를 저장하는 레지스터
    - **스택 영역**
      - 정확히는 메모리 안에 스택처럼 사용할 영역이 정해져 있다,
      - 다른 주소 공간과는 다르게 스택처럼 사용하기로 암묵적으로 약속된 영역이다.
      - 스택은 메모리 안에 존재한다.

### 특정 레지스터를 이용한 주소 지정 방식(2): 변위 주소 지정 방식
- 변위 주소 지정 방식(displacement addressing mode)
  - 오퍼랜드 필드의 값(변위)과 특정 레지스터의 값을 더하여 유효 주소를 얻어내는 주소 지정 방식이다.
  - 변위 주소 지정 방식을 사용하는 명령어는 연산 코드 필드, 어떤 레스트의 값과 더할지를 나타내는 레지스터 필드, 그리고 주소를 담고 있는 오퍼랜드 필드가 있다.
    - 이때, 변위 주소 지정 방식은 오퍼랜드 필드의 주소와 어떤 레지스터를 더하는지에 따라 **상대 주소 지정 방식, 베이스 레지스터 주소 지정 방식** 등으로 나뉜다.
    - **상대 주소 지정 방식(relative addressing mode)**
      - 오퍼랜드와 프로그램 카운터의 값을 더하여 유효 주소를 얻는 방식이다.
      - 프로그래밍 언어의 if문과 유사하게 모든 코드를 실행하는 것이 아닌, 분기하여 특정 주소의 코드를 실행할 때 사용된다.
    - **베이스 레지스터 주소 지정 방식(base-register addressing mode)**
      - 오퍼랜드와 베이스 레지스터의 값을 더하여 유효 주소를 얻는 방식이다.
      - 베이스 레지스터는 '기본주소', 오퍼랜드는 '기본 주소로부터 떨어진 거리'로서의 역할은 한다.
        - 즉, 베이스 레지스터 주소 지정 방식은 베이스 레지스터 속 기준 주소로부터 얼마나 떨어져 있는 주소에 접근할 것인지를 연ㅅ나하여 유효 주소를 얻어내는 방식이다.
---