# 2장. SQL 튜닝 용어를 직관적으로 이해하기
- SQL 튜닝에 앞서 기본적으로 알아야 할 용어를 짚고 넘어가자.
- 튜닝을 수행하는 과정에서 DBMS의 전반적인 구조와 메커니즘에 기반을 둔 종합적 사고를 필요한 만큼 현업에서 통용되는 기본적인 용어는 반드시 알고 있어야 한다.

## 2.2. 논리적인 SQL 개념 용어
- 이 절에서는 SQL 문 작성에 필요한 주변 오브젝트와 SQL 문의 상호관계, 연관성과 알고리즘에 관한 논리적 개념 용어를 다룬다.
  - 그리고 개념을 직관적으로 이해할 수 있도록 학생 테이블과 지도교수 테이블의 예제를 살펴보자.
- 학생 테이블에는 학번, 이름, 전공코드 열이 있고 지도교수 테이블에는 학번과 지도교수명 열이 있다.
  - 두 테이블은 서로 일대일 관계이다.
  - 즉, 1명의 학생은 1명의 교수에게만 소속되며 1명의 교수는 1명의 학생만 지도할 수 있는 환경이다.

#### 학생 테이블
| 학번    | 이름   | 전공코드  |
|-------|------|-------|
|  |   ||

#### 지도교수 테이블
| 학번 | 이름   |
|----|------|
|  |   |

### 2.2.1. 서브쿼리 위치에 따른 SQL 용어
- 서브쿼리(subquery)란 쿼리 안의 보조쿼리를 가리키는 용어디ㅏ.
  - 가장 바깥쪽의 SELECT 문인 메인쿼리(main query)를 기준으로 내부에 SELECT 문을 추가로 작성해서 서브쿼리를 만든다.
  - 이처럼 SELECT 문 안쪽에 위치한 SELECT 문은 어느 위치에 작성되었는지에 따라 부르는 용어가 달라진다.
  - 작성하는 위치는 크게 SELECT 절, FROM 절, WHERE 절로 나뉜다.
- 다음 쿼리는 SELECT 절, FROM 절, WHERE 절로 작성한 메인쿼리(=외부쿼리 outer query) 입니다.
  - (1)은 주로 메인쿼리의 SELECT 절 내부에 하나의 숫자나 문자, 기호 등을 출력하는 SELECT 문으로 스칼라 서브쿼리(scalar subquery) 라고 한다.
  - (2)는 메인쿼리의 FROM 절 내부에 작성한 SELECT 문으로 인라인 뷰(inline view) 라고 한다.
  - (3)은 메인쿼리의 WHERE 절 내부에 작성한 SELECT 문으로 중첩 서브쿼리(nested subquery) 라고 부른다.

```sql
SELECT (SELECT ... FROM ...)            <---- (1) SELECT 절 : 스칼라 서브쿼리
  FROM (SELECT ... FROM ...)            <---- (2) FROM 절 : 인라인 뷰
 WHERE 컬럴명 IN (SELECT ... FROM ...)    <---- (3) WHERE 절 : 중첩 서브쿼리
```

#### 스칼라 서브쿼리
- 메인쿼리의 SELECT 절에 있는 또 다른 SELECT 절이 스칼라 서브쿼리라고 앞서 설명했다.
  - 사실 FROM 절이나 WHERE 절 등에서도 스칼라 서브쿼리를 사용할 수 있으나, 대부분의 SQL 문에서 SELECT 절을 사용하므로 본 내용에서도 SELECT 절에 작성된 SELECT 문을 기준으로 설명한다.
  - 메인쿼리의 SELECT 절에는 최종 출력하려는 열들이 나열되므로, 출력 데이터 1건과 스칼라 서브쿼리의 결과 건수가 일치해야 한다.
  - 만약 스칼라 서브쿼리의 결괏값이 2개 이상 나온다면 에러가 발생할 것이다.
  - 즉, 스칼라 서브쿼리의 결괏값은 1행 1열의 구조로 출력되어야 한다.
- 다음은 학생 테이블에서 이름 데이터와 스칼라 서브쿼리의 결괏값을 출력하는 SQL 문이다.
  - 학생 1명의 이름당 스칼라 서브쿼리 결과가 1건만 출력되는 count(*)를 써서 작성했다.
  - 보통 스칼라 서브쿼리는 출력되는 데이터 건수가 1건이어야 하므로 집계함수(max, min, avg, sum, count 등)가 자주 쓰인다.
```sql
SELECT 이름,
       (SELECT COUNT(*)
          FROM 학생 AS 학생2
         WHERE 학생2.이름 = 학생1.이름) 카운트
  FROM 학생 AS 학생1;
```

#### 인라인 뷰
- 메인쿼리의 FROM 절에 있는 또 다른 SELECT 절이 인라인 뷰라고 설명했다.
  - FROM 절 내부에서 일시적으로 뷰를 생성하는 방식이므로 인라인 뷰라고 불린다.
  - 인라인 뷰의 결과는 내부적으로 메모리 또는 디스크에 임시 테이블을 생성하여 활용한다.
```sql
SELECT 학생2.학번, 학생2.이름
  FROM (SELECT *
          FROM 학생
         WHERE 성별 = '남') 학생2;
```

#### 중첩 서브쿼리
- 메인쿼리의 WHERE 절에 있는 또 다른 SELECT 절을 중첩 서브쿼리라고 앞서 설명했다.
  - WHERE 절에서 단순한 값을 비교 연산하는 대신, 서브쿼리를 추가하여 비교 연산하기 위해 중첩 서브쿼리를 사용한다.
  - 이처럼 WHERE 절에서 중첩 서브쿼리와 비교할 때는 보통 비교 연산자(=, <, >, <=, >=, <>, !=)를 비롯해 IN, EXISTS, NOT IN, NOT EXISTS 문을 많이 사용한다.
```sql
SELECT *
  FROM 학생 
 WHERE 학번 = (SELECT MAX(학번)
                FROM 학생)
```

### 2.2.2. 메인쿼리와의 관계성에 따른 SQL 용어

#### 비상관 서브쿼리


---